<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="style.css">
    <script crossorigin src="https://unpkg.com/react@16/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@16/umd/react-dom.development.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.19.0/axios.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/6.26.0/babel.js"></script>

    <title>ACME React Router</title>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const API = 'https://acme-users-api-rev.herokuapp.com/api'

        const Nav = ({companies, products, view}) => {
            const productLink = React.createElement('a', { href: '#products', className: view === 'products' ? 'active' : ''}, `Products (${products.length})`);
            const companyLink = React.createElement('a', { href: '#companies', className: view === 'companies' ? 'active' : ''}, `Companies (${companies.length})`);
            return React.createElement('div', {id: 'nav-btns'}, productLink, companyLink);
        }

        const CompanyList = ({companies}) => {
            const lis = companies.map(company => React.createElement('li', {key: company.id}, company.name));
            return React.createElement('ul', null, lis);
        }

        const ProductList = ({products}) => {
            const lis = products.map(product => React.createElement('li', {key: product.id}, `${product.name} - ${product.description}`));
            return React.createElement('ul', null, lis);
        }

        class App extends React.Component {
            constructor() {
                super()
                this.state = {
                    products: [],
                    companies: [],
                    offerings: [],
                }
            }
            componentDidMount() {
                /* api calls */
                Promise.all([
                    axios.get(`${API}/products`),
                    axios.get(`${API}/companies`),
                    axios.get(`${API}/offerings`)
                ]).then(([products, companies, offerings]) => {
                    this.setState({products, companies, offerings});
                })
            }
            render() {
                const { products, companies, offerings } = this.state;
                return (
                    <HashRouter>
                        <Route render={ (props) => <Nav products= {products} companies = {companies} offerings = {offerings} path = { props.location.pathname } /> } />
                        <Switch>
                            <Route path='/companies' component = { Companies } />
                            <Route path='/products' component = { Products } />
                            <Redirect to='/companies' />
                        </Switch>
                    </HashRouter>
                );
            }
        }

        const root = document.querySelector('#root')
        render(<App />), root)
    </script>
</body>
</html>